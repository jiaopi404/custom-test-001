<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // let data = `{"receiptCoordinate":"{"height":689,"left":55,"top":1,"width":1068}","AmountInWords":"贰拾陆圆伍角伍分","InvoiceNumConfirm":"78947296","templateSign":"vat_invoice","scores":1,"DetailsOfTax#1#CommodityName":"*运输服务*客运服务费","NoteDrawer":"王秀丽","SellerAddress":"陕西省西安市国家民用航天产业基地神舟四路239号航创创国际广场C座302室400-0000999","DetailsOfTax#1#CommodityAmount":"25.78","DetailsOfTax#1#CommodityType":"","SellerRegisterNum":"91610138MA6X3B1A27","MachineCode":"499098375016","Remarks":"","SellerBank":"招商银行股份有限公司西安高新技术开发区支行129911671110202","TotalTax":"0.77","InvoiceCodeConfirm":"061002001211","DetailsOfTax#1#CommodityUnit":"次","CheckCode":"05942337542100818772","InvoiceCode":"061002001211","InvoiceDate":"2022年03月04日","PurchaserRegisterNum":"9161000006790491XR","InvoiceTypeOrg":"陕西增值税电子普通发票","Password":"03<64*-9<1<>2+<*770>5/-9</89*6-105775632+-7/-<8272-6725/3+2+/9>+982-5*/7858326/80304*10<6587<+01032919107>1</577","Agent":"否","AmountInFiguers":"26.55","PurchaserBank":"","Checker":"陈敬怡","error_msg":"success","isStructured":true,"DetailsOfTax#1#CommodityTaxRate":"3%","City":"","TotalAmount":"25.78","PurchaserName":"陕西联兴网络科技有限公司","Province":"陕西","DetailsOfTax#1#CommodityTax":"0.77","InvoiceType":"电子普通发票","SheetNum":"","PurchaserAddress":"","DetailsOfTax#1#CommodityNum":"1","templateName":"增值税发票","error_code":0,"Payee":"张雪丽","DetailsOfTax#1#CommodityPrice":"25.78","SellerName":"陕西滴滴出行科技有限公司","InvoiceNum":"78947296"}`;

      let data = {
        id: 365,
        rmbId: 2505,
        fileId: 2765,
        invoiceCode: "78947296",
        invoiceType: "增值税发票",
        invoiceContent:
          '{"receiptCoordinate":"{"height":689,"left":55,"top":1,"width":1068}","AmountInWords":"贰拾陆圆伍角伍分","InvoiceNumConfirm":"78947296","templateSign":"vat_invoice","scores":1,"DetailsOfTax#1#CommodityName":"*运输服务*客运服务费","NoteDrawer":"王秀丽","SellerAddress":"陕西省西安市国家民用航天产业基地神舟四路239号航创创国际广场C座302室400-0000999","DetailsOfTax#1#CommodityAmount":"25.78","DetailsOfTax#1#CommodityType":"","SellerRegisterNum":"91610138MA6X3B1A27","MachineCode":"499098375016","Remarks":"","SellerBank":"招商银行股份有限公司西安高新技术开发区支行129911671110202","TotalTax":"0.77","InvoiceCodeConfirm":"061002001211","DetailsOfTax#1#CommodityUnit":"次","CheckCode":"05942337542100818772","InvoiceCode":"061002001211","InvoiceDate":"2022年03月04日","PurchaserRegisterNum":"9161000006790491XR","InvoiceTypeOrg":"陕西增值税电子普通发票","Password":"03<64*-9<1<>2+<*770>5/-9</89*6-105775632+-7/-<8272-6725/3+2+/9>+982-5*/7858326/80304*10<6587<+01032919107>1</577","Agent":"否","AmountInFiguers":"26.55","PurchaserBank":"","Checker":"陈敬怡","error_msg":"success","isStructured":true,"DetailsOfTax#1#CommodityTaxRate":"3%","City":"","TotalAmount":"25.78","PurchaserName":"陕西联兴网络科技有限公司","Province":"陕西","DetailsOfTax#1#CommodityTax":"0.77","InvoiceType":"电子普通发票","SheetNum":"","PurchaserAddress":"","DetailsOfTax#1#CommodityNum":"1","templateName":"增值税发票","error_code":0,"Payee":"张雪丽","DetailsOfTax#1#CommodityPrice":"25.78","SellerName":"陕西滴滴出行科技有限公司","InvoiceNum":"78947296"}',
        addDateTime: 1646705476000,
      };

      // data = data.replace(/"{/g, '{')
      // data = data.replace(/}"/g, '}')

      // data = JSON.parse(data);

      const invoiceMap = new Map();
      invoiceMap.set(
        "增值税发票",
        `[{"fieldLevel":1,"filedName":"ServiceType","isNecessary":true,"type":"string","desc":"发票消费类型","subDesc":"不同消费类型输出：餐饮、电器设备、通讯、服务、日用品食品、医疗、交通、其他","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"InvoiceType","isNecessary":true,"type":"string","desc":"发票种类","subDesc":"不同类型发票输出：普通发票、专用发票、电子普通发票、电子专用发票、通行费电子普票、区块链发票、通用机打电子发票","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"InvoiceTypeOrg","isNecessary":true,"type":"string","desc":"发票名称","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"InvoiceCode","isNecessary":true,"type":"string","desc":"发票代码","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"InvoiceNum","isNecessary":true,"type":"string","desc":"发票号码","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"InvoiceCodeConfirm","isNecessary":true,"type":"string","desc":"发票代码的辅助校验码","subDesc":"一般业务情景可忽略","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"InvoiceNumConfirm","isNecessary":true,"type":"string","desc":"发票号码的辅助校验码","subDesc":"一般业务情景可忽略","index":6,"arrayIndex":6},{"fieldLevel":1,"filedName":"MachineNum","isNecessary":true,"type":"string","desc":"机打号码","subDesc":"仅增值税卷票含有此参数","index":7,"arrayIndex":7},{"fieldLevel":1,"filedName":"MachineCode","isNecessary":true,"type":"string","desc":"机器编号","subDesc":"仅增值税卷票含有此参数","index":8,"arrayIndex":8},{"fieldLevel":1,"filedName":"CheckCode","isNecessary":true,"type":"string","desc":"校验码","subDesc":"增值税专票无此参数","index":9,"arrayIndex":9},{"fieldLevel":1,"filedName":"InvoiceDate","isNecessary":true,"type":"string","desc":"开票日期","subDesc":"","index":10,"arrayIndex":10},{"fieldLevel":1,"filedName":"PurchaserName","isNecessary":true,"type":"string","desc":"购方名称","subDesc":"","index":11,"arrayIndex":11},{"fieldLevel":1,"filedName":"PurchaserRegisterNum","isNecessary":true,"type":"string","desc":"购方纳税人识别号","subDesc":"","index":12,"arrayIndex":12},{"fieldLevel":1,"filedName":"PurchaserAddress","isNecessary":true,"type":"string","desc":"购方地址及电话","subDesc":"","index":13,"arrayIndex":13},{"fieldLevel":1,"filedName":"PurchaserBank","isNecessary":true,"type":"string","desc":"购方开户行及账号","subDesc":"","index":14,"arrayIndex":14},{"fieldLevel":1,"filedName":"Password","isNecessary":true,"type":"string","desc":"密码区","subDesc":"","index":15,"arrayIndex":15},{"fieldLevel":1,"filedName":"Province","isNecessary":true,"type":"string","desc":"省","subDesc":"","index":16,"arrayIndex":16},{"fieldLevel":1,"filedName":"City","isNecessary":true,"type":"string","desc":"市","subDesc":"","index":17,"arrayIndex":17},{"fieldLevel":1,"filedName":"SheetNum","isNecessary":true,"type":"string","desc":"联次信息","subDesc":"专票第一联到第三联分别输出：第一联：记账联、第二联：抵扣联、第三联：发票联；普通发票第一联到第二联分别输出：第一联：记账联、第二联：发票联","index":18,"arrayIndex":18},{"fieldLevel":1,"filedName":"Agent","isNecessary":true,"type":"string","desc":"是否代开","subDesc":"","index":19,"arrayIndex":19},{"fieldLevel":1,"filedName":"CommodityName","isNecessary":true,"type":"array","desc":"货物名称","subDesc":"","index":20,"arrayIndex":20},{"fieldLevel":1,"filedName":"CommodityType","isNecessary":true,"type":"array","desc":"规格型号","subDesc":"","index":23,"arrayIndex":23},{"fieldLevel":1,"filedName":"CommodityUnit","isNecessary":true,"type":"array","desc":"单位","subDesc":"","index":26,"arrayIndex":26},{"fieldLevel":1,"filedName":"CommodityNum","isNecessary":true,"type":"array","desc":"数量","subDesc":"","index":29,"arrayIndex":29},{"fieldLevel":1,"filedName":"CommodityPrice","isNecessary":true,"type":"array","desc":"单价","subDesc":"","index":32,"arrayIndex":32},{"fieldLevel":1,"filedName":"CommodityAmount","isNecessary":true,"type":"array","desc":"金额","subDesc":"","index":35,"arrayIndex":35},{"fieldLevel":1,"filedName":"CommodityTaxRate","isNecessary":true,"type":"array","desc":"税率","subDesc":"","index":38,"arrayIndex":38},{"fieldLevel":1,"filedName":"CommodityTax","isNecessary":true,"type":"array","desc":"税额","subDesc":"","index":41,"arrayIndex":41},{"fieldLevel":1,"filedName":"CommodityPlateNum","isNecessary":true,"type":"array","desc":"车牌号","subDesc":"仅通行费增值税电子普通发票含有此参数","index":44,"arrayIndex":44},{"fieldLevel":1,"filedName":"CommodityVehicleType","isNecessary":true,"type":"array","desc":"类型","subDesc":"仅通行费增值税电子普通发票含有此参数","index":47,"arrayIndex":47},{"fieldLevel":1,"filedName":"CommodityStartDate","isNecessary":true,"type":"array","desc":"通行日期起","subDesc":"仅通行费增值税电子普通发票含有此参数","index":50,"arrayIndex":50},{"fieldLevel":1,"filedName":"CommodityEndDate","isNecessary":true,"type":"array","desc":"通行日期止","subDesc":"仅通行费增值税电子普通发票含有此参数","index":53,"arrayIndex":53},{"fieldLevel":1,"filedName":"OnlinePay","isNecessary":true,"type":"string","desc":"电子支付标识","subDesc":"仅区块链发票含有此参数","index":56,"arrayIndex":56},{"fieldLevel":1,"filedName":"SellerName","isNecessary":true,"type":"string","desc":"销售方名称","subDesc":"","index":57,"arrayIndex":57},{"fieldLevel":1,"filedName":"SellerRegisterNum","isNecessary":true,"type":"string","desc":"销售方纳税人识别号","subDesc":"","index":58,"arrayIndex":58},{"fieldLevel":1,"filedName":"SellerAddress","isNecessary":true,"type":"string","desc":"销售方地址及电话","subDesc":"","index":59,"arrayIndex":59},{"fieldLevel":1,"filedName":"SellerBank","isNecessary":true,"type":"string","desc":"销售方开户行及账号","subDesc":"","index":60,"arrayIndex":60},{"fieldLevel":1,"filedName":"TotalAmount","isNecessary":true,"type":"string","desc":"合计金额","subDesc":"","index":61,"arrayIndex":61},{"fieldLevel":1,"filedName":"TotalTax","isNecessary":true,"type":"string","desc":"合计税额","subDesc":"","index":62,"arrayIndex":62},{"fieldLevel":1,"filedName":"AmountInWords","isNecessary":true,"type":"string","desc":"价税合计(大写)","subDesc":"","index":63,"arrayIndex":63},{"fieldLevel":1,"filedName":"AmountInFiguers","isNecessary":true,"type":"string","desc":"价税合计(小写)","subDesc":"","index":64,"arrayIndex":64},{"fieldLevel":1,"filedName":"Payee","isNecessary":true,"type":"string","desc":"收款人","subDesc":"","index":65,"arrayIndex":65},{"fieldLevel":1,"filedName":"Checker","isNecessary":true,"type":"string","desc":"复核","subDesc":"","index":66,"arrayIndex":66},{"fieldLevel":1,"filedName":"NoteDrawer","isNecessary":true,"type":"string","desc":"开票人","subDesc":"","index":67,"arrayIndex":67},{"fieldLevel":1,"filedName":"Remarks","isNecessary":true,"type":"string","desc":"备注","subDesc":"","index":68,"arrayIndex":68}]`
      );
      invoiceMap.set(
        "定额发票",
        `[{"fieldLevel":1,"filedName":"invoice_code","isNecessary":false,"type":"string","desc":"发票代码","subDesc":"","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"invoice_number","isNecessary":false,"type":"string","desc":"发票号码","subDesc":"","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"invoice_rate","isNecessary":false,"type":"string","desc":"金额","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"location","isNecessary":false,"type":"string","desc":"发票所在地","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"invoice_rate_lowercase","isNecessary":false,"type":"string","desc":"发票金额小写","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"province","isNecessary":false,"type":"string","desc":"省","subDesc":"","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"city","isNecessary":false,"type":"string","desc":"市","subDesc":"","index":6,"arrayIndex":6}]`
      );
      invoiceMap.set(
        "出租车发票",
        `[{"fieldLevel":1,"filedName":"InvoiceCode","isNecessary":true,"type":"string","desc":"发票代号","subDesc":"","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"InvoiceNum","isNecessary":true,"type":"string","desc":"发票号码","subDesc":"","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"TaxiNum","isNecessary":true,"type":"string","desc":"车牌号","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"Date","isNecessary":true,"type":"string","desc":"日期","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"Time","isNecessary":true,"type":"string","desc":"上下车时间","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"PickupTime","isNecessary":true,"type":"string","desc":"上车时间","subDesc":"","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"DropoffTime","isNecessary":true,"type":"string","desc":"下车时间","subDesc":"","index":6,"arrayIndex":6},{"fieldLevel":1,"filedName":"Fare","isNecessary":true,"type":"string","desc":"金额","subDesc":"","index":7,"arrayIndex":7},{"fieldLevel":1,"filedName":"FuelOilSurcharge","isNecessary":true,"type":"string","desc":"燃油附加费","subDesc":"","index":8,"arrayIndex":8},{"fieldLevel":1,"filedName":"CallServiceSurcharge","isNecessary":true,"type":"string","desc":"叫车服务费","subDesc":"","index":9,"arrayIndex":9},{"fieldLevel":1,"filedName":"TotalFare","isNecessary":true,"type":"string","desc":"总金额","subDesc":"","index":10,"arrayIndex":10},{"fieldLevel":1,"filedName":"Location","isNecessary":true,"type":"string","desc":"开票城市","subDesc":"","index":11,"arrayIndex":11},{"fieldLevel":1,"filedName":"Province","isNecessary":true,"type":"string","desc":"省","subDesc":"","index":12,"arrayIndex":12},{"fieldLevel":1,"filedName":"City","isNecessary":true,"type":"string","desc":"市","subDesc":"","index":13,"arrayIndex":13},{"fieldLevel":1,"filedName":"PricePerkm","isNecessary":true,"type":"string","desc":"单价","subDesc":"","index":14,"arrayIndex":14},{"fieldLevel":1,"filedName":"Distance","isNecessary":true,"type":"string","desc":"里程","subDesc":"","index":15,"arrayIndex":15}]`
      );
      invoiceMap.set(
        "汽车票",
        `[{"fieldLevel":1,"filedName":"InvoiceCode","isNecessary":true,"type":"string","desc":"发票代码","subDesc":"","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"InvoiceNum","isNecessary":true,"type":"string","desc":"发票号码","subDesc":"","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"Date","isNecessary":true,"type":"string","desc":"日期","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"Time","isNecessary":true,"type":"string","desc":"时间","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"StartingStation","isNecessary":true,"type":"string","desc":"出发站","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"Fare","isNecessary":true,"type":"string","desc":"金额","subDesc":"","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"IdNum","isNecessary":true,"type":"string","desc":"身份证号","subDesc":"","index":6,"arrayIndex":6},{"fieldLevel":1,"filedName":"DestinationStation","isNecessary":true,"type":"string","desc":"到达站","subDesc":"","index":7,"arrayIndex":7},{"fieldLevel":1,"filedName":"Name","isNecessary":true,"type":"string","desc":"姓名","subDesc":"","index":8,"arrayIndex":8}]`
      );
      invoiceMap.set(
        "火车票",
        `[{"fieldLevel":1,"filedName":"ticket_num","isNecessary":true,"type":"string","desc":"车票号","subDesc":"","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"starting_station","isNecessary":true,"type":"string","desc":"始发站","subDesc":"","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"train_num","isNecessary":true,"type":"string","desc":"车次号","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"destination_station","isNecessary":true,"type":"string","desc":"到达站","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"date","isNecessary":true,"type":"string","desc":"出发日期","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"ticket_rates","isNecessary":true,"type":"string","desc":"车票金额","subDesc":"","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"seat_category","isNecessary":true,"type":"string","desc":"席别","subDesc":"","index":6,"arrayIndex":6},{"fieldLevel":1,"filedName":"name","isNecessary":true,"type":"string","desc":"乘客姓名","subDesc":"","index":7,"arrayIndex":7},{"fieldLevel":1,"filedName":"id_num","isNecessary":true,"type":"string","desc":"身份证号","subDesc":"","index":8,"arrayIndex":8},{"fieldLevel":1,"filedName":"serial_number","isNecessary":true,"type":"string","desc":"序列号","subDesc":"","index":9,"arrayIndex":9},{"fieldLevel":1,"filedName":"sales_station","isNecessary":true,"type":"string","desc":"售站","subDesc":"","index":10,"arrayIndex":10},{"fieldLevel":1,"filedName":"time","isNecessary":true,"type":"string","desc":"时间","subDesc":"","index":11,"arrayIndex":11},{"fieldLevel":1,"filedName":"seat_num","isNecessary":true,"type":"string","desc":"座位号","subDesc":"","index":12,"arrayIndex":12}]`
      );
      invoiceMap.set(
        "行程单",
        `[{"fieldLevel":1,"filedName":"name","isNecessary":true,"type":"string","desc":"姓名","subDesc":"","index":0,"arrayIndex":0},{"fieldLevel":1,"filedName":"starting_station","isNecessary":true,"type":"string","desc":"始发站","subDesc":"","index":1,"arrayIndex":1},{"fieldLevel":1,"filedName":"destination_station","isNecessary":true,"type":"string","desc":"目的站","subDesc":"","index":2,"arrayIndex":2},{"fieldLevel":1,"filedName":"flight","isNecessary":true,"type":"string","desc":"航班号","subDesc":"","index":3,"arrayIndex":3},{"fieldLevel":1,"filedName":"date","isNecessary":true,"type":"string","desc":"日期","subDesc":"","index":4,"arrayIndex":4},{"fieldLevel":1,"filedName":"ticket_number","isNecessary":true,"type":"string","desc":"电子客票号码","subDesc":"","index":5,"arrayIndex":5},{"fieldLevel":1,"filedName":"fare","isNecessary":true,"type":"string","desc":"票价","subDesc":"","index":6,"arrayIndex":6},{"fieldLevel":1,"filedName":"dev_fund","isNecessary":true,"type":"string","desc":"民航发展基金/基建费","subDesc":"","index":7,"arrayIndex":7},{"fieldLevel":1,"filedName":"fuel_surcharge","isNecessary":true,"type":"string","desc":"燃油附加费","subDesc":"","index":8,"arrayIndex":8},{"fieldLevel":1,"filedName":"other_tax","isNecessary":true,"type":"string","desc":"其他税费","subDesc":"","index":9,"arrayIndex":9},{"fieldLevel":1,"filedName":"ticket_rates","isNecessary":true,"type":"string","desc":"合计金额","subDesc":"","index":10,"arrayIndex":10},{"fieldLevel":1,"filedName":"issued_date","isNecessary":true,"type":"string","desc":"填开日期","subDesc":"","index":11,"arrayIndex":11},{"fieldLevel":1,"filedName":"id_num","isNecessary":true,"type":"string","desc":"身份证号","subDesc":"","index":12,"arrayIndex":12},{"fieldLevel":1,"filedName":"carrier","isNecessary":true,"type":"string","desc":"承运人","subDesc":"","index":13,"arrayIndex":13},{"fieldLevel":1,"filedName":"time","isNecessary":true,"type":"string","desc":"时间","subDesc":"","index":14,"arrayIndex":14},{"fieldLevel":1,"filedName":"issued_by","isNecessary":true,"type":"string","desc":"订票渠道","subDesc":"","index":15,"arrayIndex":15},{"fieldLevel":1,"filedName":"serial_number","isNecessary":true,"type":"string","desc":"印刷序号","subDesc":"","index":16,"arrayIndex":16},{"fieldLevel":1,"filedName":"insurance","isNecessary":true,"type":"string","desc":"保险费","subDesc":"","index":17,"arrayIndex":17},{"fieldLevel":1,"filedName":"fare_basis","isNecessary":true,"type":"string","desc":"客票级别","subDesc":"","index":18,"arrayIndex":18},{"fieldLevel":1,"filedName":"class","isNecessary":true,"type":"string","desc":"座位等级","subDesc":"","index":19,"arrayIndex":19},{"fieldLevel":1,"filedName":"agent_code","isNecessary":true,"type":"string","desc":"销售单位号","subDesc":"","index":20,"arrayIndex":20},{"fieldLevel":1,"filedName":"endorsement","isNecessary":true,"type":"string","desc":"签注","subDesc":"","index":21,"arrayIndex":21},{"fieldLevel":1,"filedName":"allow","isNecessary":true,"type":"string","desc":"免费行李","subDesc":"","index":22,"arrayIndex":22},{"fieldLevel":1,"filedName":"ck","isNecessary":true,"type":"string","desc":"验证码","subDesc":"","index":23,"arrayIndex":23}]`
      );

      const invoiceParser = (rmbInvoiceInfo) => {
        const invoiceData = invoiceContentPreProcessor(
          rmbInvoiceInfo.invoiceContent
        );
        const invoiceFields = JSON.parse(invoiceMap.get(rmbInvoiceInfo.invoiceType));

        const resFields = []; // 结果头 field 列表
        const res = {};
        const resTable = {}; // { fieldList, data:  }
        for (const [key, value] of Object.entries(invoiceData)) {
          const keyParseRes = keyParser(key)

          if (keyParseRes) {
            // 表格
            const { field, index, fieldName } = keyParseRes;
            if (!resTable[field]) {
              resTable[field] = { fieldList: [], data: [] }
            }
            const fieldList = resTable[field].fieldList;
            const subDataList = resTable[field].data;
            if (!subDataList[index - 1]) {
              subDataList[index - 1] = {}
            }
            subDataList[index - 1][fieldName] = value; // 赋值
            if (fieldList.findIndex(item => item.fieldName === fieldName) === -1) {
              const fieldObj = invoiceFields.find(item => item.filedName === fieldName)
              if (fieldObj) {
                fieldList.push(fieldObj)
              }
            }
          } else {
            // 非表格
            res[key] = value;
            const fieldObj = invoiceFields.find(item => item.filedName === key)
            if (fieldObj) {
              resFields.push(fieldObj)
            }
          }
        }

        resFields.sort((a, b) => a.index - b.index);
        for (let key in resTable) {
          resTable[key].fieldList.sort((a, b) => a.index - b.index);
        }
        return { resFields, res, resTable, hasTable: Object.keys(resTable).length > 0 }
      };

      function invoiceContentPreProcessor(invoiceContent) {
        invoiceContent = invoiceContent.replace(/"{/g, "{").replace(/}"/g, "}");

        return JSON.parse(invoiceContent);
      }

      function keyParser (key) {
        const arrayPattern = /(\w+)#(\d+)#(\w+)/;

        const result = arrayPattern.exec(key);

        console.log('result is: ', result);

        if (result) {
          return { field: result[1], index: result[2], fieldName: result[3] };
        } else {
          return null;
        }
      }

      function start() {
        const { res, resFields, resTable, hasTable } = invoiceParser(data);
        console.log(res, resFields, resTable, hasTable);
      }
      start();
    </script>
  </body>
</html>
