<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    // const data = JSON.parse(`[{"id":1,"catalog_number":"01","catalog_name":"xx 项目流程目录","is_leaf":2,"department":"xx责任部门","complete_percent":60,"flow_id":"","flow_name":"","page_name":"","children":[{"id":1597228173244,"catalog_number":"01.","catalog_name":"ddfadf","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"flow_1597228176063","page_name":"","parent_name":"xx 项目流程目录","children":[{"id":1597228179406,"catalog_number":"01.01.","catalog_name":"sadfdas","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"ddfadf","children":[{"id":1597228323594,"catalog_number":"01.01.01.","catalog_name":"dsfsaf","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"sadfdas"}]},{"id":1597299943928,"catalog_number":"01.02.","catalog_name":"带数据库奋斗精神","is_leaf":1,"department":"俺是个责任部门了兄弟","complete_percent":30,"flow_id":78,"flow_name":"flow_011","page_name":"01.02预算执行与分析","parent_name":"ddfadf"}]},{"id":1597386335448,"catalog_number":"02.","catalog_name":"一级目录2","is_leaf":2,"department":"","complete_percent":0,"flow_id":44,"flow_name":"flow_template_001","page_name":"","parent_name":"xx 项目流程目录","children":[{"id":1597391176027,"catalog_number":"02.01.","catalog_name":"二级目录下边的","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"一级目录2"}]}]}]`)
    const data = JSON.parse(`[{"id":1,"catalog_number":"01","catalog_name":"xx 项目流程目录","is_leaf":2,"department":"xx责任部门","complete_percent":60,"flow_id":"","flow_name":"","page_name":"","children":[{"id":1597228173244,"catalog_number":"01.","catalog_name":"ddfadf","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"flow_1597228176063","page_name":"","parent_name":"xx 项目流程目录","children":[{"id":1597228179406,"catalog_number":"01.01.","catalog_name":"sadfdas","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"ddfadf","children":[{"id":1597228323594,"catalog_number":"01.01.01.","catalog_name":"dsfsaf","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"sadfdas","children":[{"id":1597393560606,"catalog_number":"01.01.01.01.","catalog_name":"21345染头发滚动时","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"dsfsaf"},{"id":1597393573960,"catalog_number":"01.01.01.03.","catalog_name":"我的发斯蒂芬v","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"dsfsaf"},{"id":1597393584981,"catalog_number":"01.01.01.03.","catalog_name":"请34儿童房给","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"dsfsaf"}]}]},{"id":1597299943928,"catalog_number":"01.02.","catalog_name":"带数据库奋斗精神","is_leaf":1,"department":"俺是个责任部门了兄弟","complete_percent":30,"flow_id":78,"flow_name":"flow_011","page_name":"01.02预算执行与分析","parent_name":"ddfadf"}]},{"id":1597386335448,"catalog_number":"02.","catalog_name":"一级目录2","is_leaf":2,"department":"","complete_percent":0,"flow_id":44,"flow_name":"flow_template_001","page_name":"","parent_name":"xx 项目流程目录","children":[{"id":1597391176027,"catalog_number":"02.01.","catalog_name":"二级目录下边的","is_leaf":2,"department":"","complete_percent":0,"flow_id":"","flow_name":"","page_name":"","parent_name":"一级目录2"}]}]}]`)
    // const data = [
    //   { id: 4, name: Math.floor(Math.random() * 1000), parent: 2 },
    //   { id: 6, name: Math.floor(Math.random() * 1000), parent: 5 },
    //   { id: 2, name: Math.floor(Math.random() * 1000), parent: 1 },
    //   { id: 5, name: Math.floor(Math.random() * 1000), parent: 1 },
    //   { id: 3, name: Math.floor(Math.random() * 1000), parent: 2 },
    //   { id: 1, name: Math.floor(Math.random() * 1000), parent: null }
    // ]
    // const data = dataGetter(30)
    // console.log(data)
    function reTree (data) {
      const ID = 'id'
      const PARENT = 'parent_id'
      const parentIdMap = {
        root: []
      }
      data.forEach(item => {
        if (!item[PARENT]) {
          parentIdMap['root'].push(item)
          return
        }
        if (!Object.prototype.hasOwnProperty.call(parentIdMap, item[PARENT])) {
          parentIdMap[item[PARENT]] = []
        }
        parentIdMap[item[PARENT]].push(item)
      })

      // debugger
      const result = {}
      connector(result, 'root', parentIdMap)
      // console.log(result.children)
      return result.children
    }

    function connector (result, key, parentMap) {
      if (parentMap[key]) {
        result.children = parentMap[key]
        result.children.forEach(item => {
          connector(item, item.id, parentMap)
        })
      } else {
        return result
      }
    }

    function dataGetter (count) {
      const _tempList = []
      for (let i = 0; i < count; i++) {
        _tempList.push({ id: Math.floor(Math.random() * 10) + 1, name: Math.floor(Math.random() * 1000), parent: Math.floor(Math.random() * 10) + 1 })
      }
      return _tempList
    }

    // const tree = reTree(data)
    // console.log('tree is: ', tree)
    const list = getTreeRecursive(data[0], [], '')
    console.log('list is: ', list, JSON.stringify(list))

    const _tree = reTree(list)
    console.log('_tree is: ', _tree)

    function getTreeRecursive (root, result, parentId) {
      if (Object.prototype.hasOwnProperty.call(root, 'children')) {
        result.push(Object.assign({}, root, { children: null, parent_id: parentId }))
        root.children.forEach(item => {
          getTreeRecursive(item, result, root.id)
        })
      } else {
        result.push(Object.assign({}, root, { children: null, parent_id: parentId }))
      }
      return result
    }
  </script>
</body>
</html>